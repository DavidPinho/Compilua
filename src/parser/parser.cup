import java_cup.runtime.*;
import tree.*;
import tree.Number;


/* Terminals (tokens returned by lexer). */

terminal      SEMICOLON, ASSIGN_OP, DO_KWORD, END_KWORD, WHILE;
terminal      IF_KWORD, THEN_KWORD;
terminal      ELSE_KWORD, COMA, FOR_KWORD, VAR_KWORD;
terminal      DOT, COLON;
terminal      LBRACKET, RBRACKET;
terminal      LPAREN, RPAREN;
terminal      PLUS_OP, MINUS_OP, TIMES_OP, SLASH_OP, POT_OP, PERCENT_OP;
terminal      LESSEQUALS_OP, MOREEQUALS_OP, LESS_OP, MORE_OP, EQUALS_OP, DIFFERENT_OP;
terminal      AND_KWORD, OR_KWORD, NOT_KWORD, HASH_OP, MINUS_UNOP;

terminal 	  java.lang.Number NUMBER;
terminal 	  java.lang.String STRING;
terminal 	  java.lang.String IDENTIFIER;


/*NON TERMINALS */

non terminal  Bloco bloco;
non terminal  Comando comando;
non terminal  ifstat, elsestat;
non terminal  var, chamadadefuncao, args;
non terminal  Exp listaexp, listaexpaux;
non terminal  Exp exp, expprefixo;
non terminal  opbin, opunaria;
non terminal  declaracaovariavel;


//--------------- Precedences---------------------------------------------- 

precedence left COMA;
precedence left OR_KWORD;
precedence left AND_KWORD;
precedence left LESS_OP, MORE_OP, LESSEQUALS_OP, MOREEQUALS_OP, DIFFERENT_OP, EQUALS_OP;
precedence left PLUS_OP,MINUS_OP;
precedence left TIMES_OP, SLASH_OP, PERCENT_OP;
precedence left NOT_KWORD, HASH_OP, PERCENT_OP, MINUS_UNOP;
precedence right POT_OP;
precedence left LPAREN, RPAREN;




//----------------The grammar---------------------------------------------------- 

start with bloco;


bloco 	    ::= bloco:b comando:c {: RESULT = new Bloco(b,c); :}
					| bloco:b comando:c SEMICOLON {: RESULT = new Bloco(b,c); :}
					|
					;

	
comando     ::=	IDENTIFIER:id ASSIGN_OP exp:e	 {: RESULT = new Comando(id, e);:}		       
					       | WHILE exp DO_KWORD bloco END_KWORD
					       | ifstat
				           | chamadadefuncao			
				           | declaracaovariavel                        
				           ;


ifstat 	        ::=   IF_KWORD exp THEN_KWORD bloco elsestat END_KWORD;

//esse n�o � necessario
elsestat        ::=   ELSE_KWORD bloco
					      |
					      ;

/*
var    ::=	    IDENTIFIER	 {: System.out.println("identifier");:}
					|  expprefixo LBRACKET exp RBRACKET
					|  expprefixo DOT IDENTIFIER
					;
						 
*/

listaexp   ::=      listaexpaux  exp;

listaexpaux  ::=    listaexpaux exp COMA 
						|
						;
						


exp       ::=	     NUMBER:n1 {: RESULT = new Exp(n1);:}
					   |  IDENTIFIER:id {: RESULT =  new Exp(id); :}
					   |  chamadadefuncao
					   |  expprefixo 
					   |  exp opbin exp
					   |  opunaria exp
					   ; 


expprefixo   ::=         var
						  |   LPAREN exp RPAREN	
						  ; 

chamadadefuncao ::=  	expprefixo args
							| expprefixo COLON IDENTIFIER args
							;


args   ::=    LPAREN RPAREN
					|  LPAREN listaexp RPAREN
					|  STRING
					;




opbin   ::=         PLUS_OP {: System.out.println("+");:}
						|   MINUS_OP {: System.out.println("-");:}
						|    TIMES_OP {: System.out.println("*");:}
						|    SLASH_OP {: System.out.println("/");:}
						|    POT_OP
						|    PERCENT_OP
						|    LESS_OP
						|    LESSEQUALS_OP
						|    MORE_OP 
						|    MOREEQUALS_OP
						|    EQUALS_OP
						|    DIFFERENT_OP
						|    AND_KWORD
						|    OR_KWORD
						;


opunaria   ::=     MINUS_UNOP
					   |   NOT_KWORD
					   |   HASH_OP
					   ;

declaracaovariavel ::= VAR_KWORD IDENTIFIER
						| VAR_KWORD IDENTIFIER ASSIGN_OP exp
						;